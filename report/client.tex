\section{Client}
\label{section:client}

The client library of SimpleChubby is mainly responsible for sending RPCs to the
server, and returning the results to the user-level applications. Moreover, to
support event handling, the client library also needs to monitor the event
message delivered from the server and up-call to the user level. Finally, when
the leader server fails, the client library needs to figure out the new leader
after server-side view change, and helps to recover some non-persistent state
at the server side.

The event handling at client side is asynchronous. Some functions, including
\texttt{acquire()}, can put the main thread into sleep. We guarantee that the
event handling will not be blocked by the user application. This is necessary
for the applications we implemented in Section~\ref{section:apps}.
% More details can be found in Section~\ref{section:impl}.

To ensure in-time event handling, the main thread can't be used. We use
another thread to monitor the event message and up-call the event callbacks.
A dedicated polling thread is used to poll the messages received from the server
and deliver to main thread (if is the result of a RPC call) or event handling
thread (if is an event).


The leader only replicates and persistently keeps part of its state for
simplicity, as described in Section~\ref{TODO}. When failure happens, some
states, including the lock waiting queues and the event subscribing lists,
will be lost and can't be automatically recovered at the new leader. Therefore,
the client library needs to keep this information locally. When it connects
to the new leader server, it needs to re-send the \texttt{acquire()} RPC,
and tells the new leader all the events it subscribes.

\subsection{Details about the client}
To be simple, and avoid overwhelming the server, the client process will block until a remote procedure call is
replied unless the leader server fails. That is, only one outstanding remote procedure call is allowed between
a client and the leader server.

